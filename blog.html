<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>GlucosIQ&trade;</title>
  <link rel="stylesheet" href="./css/index.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.2/TweenMax.min.js"></script>
</head>

<body>
  <div class="page-wrapper">

    <header class='header header--full-bleed'>
      <div class="container navigation-container">
        <div class='logo'>
          <a href="index.html">GlucosIQ&trade;</a>
        </div>
        <nav class='nav'>
          <ul class="nav__list">
            <li><a href="about.html" class="nav__link">About Us</a></li>
            <li><a href="blog.html" class="nav__link">Case Studies</a></li>
            <li><a href="https://glucosiq.net/" class="nav__link nav__link--emphasize">Sign Up</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <section class="hero hero--full-bleed about-hero">
      <div class="container hero-container">
        <div class="close-post">x</div>
        <h1 class="hero__title">GlucosIQ&trade; Case Studies & Resources</h1>
      </div>
      <div class="hero-waves"></div>
    </section>

    <section class="container posts-container">
      
      <div class="post">
        <img src="./assets/kitten-post1-sm.jpg"  data-src="./assets/kitten-post1-lg.jpg" alt="">
        <div class="post__content">
          <h3>Glycemia improvement in People with T2D</h3>
          <div class="post__blurb">
            <p>Insulin management can be an arduous process for a person with diabetes (PWD). While mobile health technologies (mHealth) have emerged to help PWDs track blood glucose (BG), whether mHealth tools can be effective for insulin management and dose titration remains unclear.</p>
            <p>In this feasibility study, we evaluated the extent to which an mHealth app for long-acting insulin (LAI) dose adjustment can help people with type 2 diabetes make appropriate titration adjustments and improve their glycemic status.</p>
          </div>
        </div>
      </div>
      <div class="post">
        <img src="./assets/kitten-post2-sm.jpg"  data-src="./assets/kitten-post2-lg.jpg" alt="">
        <div class="post__content">
          <h3>GlucosIQ: Trends and Patterns</h3>
          <div class="post__blurb">
            <p>We recently launched a redesigned version of the GlucosIQ Mobile App with pattern recognition features that will tell you what time of day you frequently go high or low, which day of the week you had your best blood glucose control and how your blood glucose data compares to the last time period.</p>
            <p>With easier navigation to help you find the information that youâ€™re looking for and a fresh new look, the new GlucosIQ Mobile App is packed with insights to help you improve your diabetes health outcomes in a way that fits your lifestyle.</p>
            <p>Join GlucosIQ's Product Manager, Stephen Bondor, as he walks you through how to use the new GlucosIQ Mobile App so you can make the most of the new pattern recognition features to improve your diabetes management.</p>
          </div>
        </div>
      </div>
    </section>
  </div>

  <footer class="footer">
    <div class="copyright">&copy; 2019 GlucosIQ&trade; Al rights reserved.</div>
  </footer>
  <script>
    class Animation {
      constructor(props) {
        this.element = props.element;
        this.modifier = props.modifier;
        this.fromPlaceholder;
        this.toPlaceholder;
      }
      
      deeply(params, parent, callback) {
        let result = callback(element, ...params);
        if ( element.children.length === 0 ) {
          return result;
        }
        
        for ( let i = 0; i < element.children.length; i += 1 ) {
          result[element.children[i]] = this.deeply([], element.children[i], callback);
        }

        let obj = getCoords(element, topLevel);
        if ( element.children.length === 0 ) {
          return obj;
        }
        for ( let i = 0; i < element.children.length; i += 1 ) {
          obj[element.children[i]] = getDeepCoords(element.children[i]);
        }
        return obj;
      }

      transitionTo(target) {
        let fromCoords = getDeepCoords(target);
        let fromPlaceholder = target.cloneNode('deep');

        fromPlaceholder.style.width = target.offsetWidth + 'px';
        fromPlaceholder.style.height = target.offsetHeight + 'px';
        fromPlaceholder.style.visibility = 'hidden';
        fromPlaceholder.classList.add(this.element.slice(1) + '-placeholder');

        let toPlaceholder = event.target.cloneNode('deep');
        toPlaceholder.classList.add(this.modifier.slice(1));
        toPlaceholder.style.visibility = 'hidden';
        event.target.after(toPlaceholder);
        let toCoords = getDeepCoords(toPlaceholder, true);

        event.target.style.maxWidth = '100vw';
        event.target.style.maxHeight = '100vh';
        event.target.after(fromPlaceholder);

        animateDeep(target, fromCoords, toCoords);
        window.setTimeout(() => {
          toPlaceholder.style = '';
          target.remove();
        }, 330);
      }

      transitionFrom() {

      }
    }

let postAnimation = new Animation({
  element: '.post',
  modifier: '.post--focused',
});

document.addEventListener('click', (event) => {
  if (event.target.matches('.close-post')) {
    closePost();
    return;
  }

  if ( !event.target.matches('.post') || event.target.matches('.post--focused') ) return;

  fixHeader();
  let fromCoords = getDeepCoords(event.target, true);
  let fromPlaceholder = event.target.cloneNode('deep');

  fromPlaceholder.style.width = event.target.offsetWidth + 'px';
  fromPlaceholder.style.height = event.target.offsetHeight + 'px';
  fromPlaceholder.style.visibility = 'hidden';
  fromPlaceholder.classList.add('post--placeholder');

  let toPlaceholder = event.target.cloneNode('deep');
  toPlaceholder.classList.add('post--focused');
  toPlaceholder.style.visibility = 'hidden';
  event.target.after(toPlaceholder);
  let toCoords = getDeepCoords(toPlaceholder, true);

  event.target.style.maxWidth = '100vw';
  event.target.after(fromPlaceholder);

  animateDeep(event.target, fromCoords, toCoords);
  document.querySelector('.close-post').style.visibility = 'visible';
  document.querySelector('.close-post').style.opacity = '1';

  window.setTimeout(() => {
    toPlaceholder.style = '';
    toPlaceholder.querySelector('img').src = toPlaceholder.querySelector('img').dataset.src;
    event.target.remove();
  }, 330);
});

const fixHeader = () => {
  document.querySelector('body').classList.toggle('body--fixed')
  
  var scrollStep = -window.scrollY / (250 / 15),
    scrollInterval = setInterval(function(){
    if ( window.scrollY != 0 ) {
      window.scrollBy( 0, scrollStep );
    }
    else clearInterval(scrollInterval); 
  }, 15);
};

const animateDeep = (element, from, to) => {
  element.style.position = 'fixed';
  element.style.marginTop = '0px';
  TweenMax.fromTo(element, 0.33, {
    top: from.top,
    left: from.left,
    width: from.width,
    height: from.height,
  }, {
    top: to.top,
    left: to.left,
    width: to.width,
    height: to.height,
  });

  for ( let i = 0; i < element.children.length; i += 1 ) {
    animateDeep(element.children[i], from[element.children[i]], to[element.children[i]]);
  }
}

const getDeepCoords = (element, topLevel = false) => {
  let obj = getCoords(element, topLevel);
  if ( element.children.length === 0 ) {
    return obj;
  }
  for ( let i = 0; i < element.children.length; i += 1 ) {
    obj[element.children[i]] = getDeepCoords(element.children[i]);
  }
  return obj;
}

const getCoords = (element, topLevel) => {
  let top = element.getBoundingClientRect().top;
  let left = element.getBoundingClientRect().left;
  return {
    top: top,
    left: left,
    width: element.offsetWidth,
    height: element.offsetHeight
  }
}

// TODO: Switch deep coords logic so top level is true, then in function for children pass false
document.addEventListener('keyup', (event) => {
  if (!event.keyCode === 27 || !document.querySelector('.post--focused')) return;
  closePost();
});

const closePost = () => {
  fixHeader();
  let element = document.querySelector('.post--focused');
  let placeholder = document.querySelector('.post--placeholder');

  let fromCoords = getDeepCoords(element, true);
  let toCoords = getDeepCoords(placeholder, true);

  document.querySelector('.close-post').style.opacity = '0';

  animateDeep(element, fromCoords, toCoords);
  window.setTimeout(() => {
    document.querySelector('.close-post').style.visibility = 'visible';
    placeholder.style = '';
    placeholder.classList.remove('post--placeholder');
    element.remove();
  }, 330);
}
</script>
</body>

</html>